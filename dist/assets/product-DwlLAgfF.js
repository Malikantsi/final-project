document.addEventListener("DOMContentLoaded",function(){let s=1;const p=9;let d=[],o=[];const C=document.querySelector(".products-grid"),f=document.getElementById("prev-page"),h=document.getElementById("next-page"),x=document.getElementById("page-info"),v=document.getElementById("search-input"),A=document.getElementById("search-btn"),b=document.getElementById("category-filter"),I=document.getElementById("price-filter"),E=document.getElementById("age-filter"),k=document.getElementById("sort-by");function T(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t)}function P(){const a=(JSON.parse(localStorage.getItem("cart"))||[]).reduce((e,i)=>e+i.quantity,0);document.querySelector(".cart-count").textContent=a}function m(t){const a=document.createElement("div");a.className="api-alert",a.textContent=t,document.body.prepend(a),setTimeout(()=>a.remove(),3e3)}document.addEventListener("DOMContentLoaded",async function(){const t=document.querySelector(".products-grid"),a=document.getElementById("loading");a.style.display="block",t.innerHTML="";try{let e=await S();(!e||e.length===0)&&(e=w(),m("Showing demo data - API unavailable")),l(e),localStorage.setItem("cachedToys",JSON.stringify(e))}catch(e){console.error("Error:",e),l(),m("⚠️ Using offline demo data")}finally{a.style.display="none"}});async function S(){return(await(await fetch("https://api.bluecartapi.com/request?api_key=7F5D6834A13048A282098FCBE16A9998&type=search&search_term=toys&sort_by=best_seller&size=12")).json()).search_results.map((e,i)=>({id:e.product.item_id||i,title:e.product.title,price:e.offers.primary?.price||(Math.random()*50+10).toFixed(2),description:e.product.description||"Popular children's toy",image:e.product.images?.[0]||`https://via.placeholder.com/300?text=Toy+${i+1}`,rating:Math.min(5,Math.random()*1.5+3.5).toFixed(1),category:["educational","plush","outdoor","arts"][i%4]}))}function w(){return[{id:1,title:"LEGO Classic Creative Brick Box",price:29.99,description:"Build anything you can imagine with these colorful bricks!",category:"building",ageGroup:"5-8",rating:{rate:4.8,count:120},image:"images/lego-bricks.jpg",stock:35,materials:"Plastic",safetyInfo:"Non-toxic, BPA-free materials"},{id:2,title:"Cuddly Teddy Bear",price:19.99,description:"Soft and huggable teddy bear for bedtime comfort",category:"plush",ageGroup:"0-1",rating:{rate:4.5,count:85},image:"images/teddy-bear.jpg",stock:42,materials:"Plush fabric, Polyester filling",safetyInfo:"Machine washable, hypoallergenic"},{id:3,title:"Junior Scientist Kit",price:34.99,description:"Fun experiments to spark scientific curiosity",category:"educational",ageGroup:"8-12",rating:{rate:4.7,count:65},image:"images/science-kit.jpg",stock:18,materials:"Plastic, Paper",safetyInfo:"Adult supervision recommended"}]}function l(){const t=(s-1)*p,a=t+p,e=o.slice(t,a);C.innerHTML=e.map(n=>`
            <div class="product-card">
                <div class="product-image">
                    <img src="${n.image}" alt="${n.title}" onerror="this.src='images/placeholder-toy.jpg'">
                    <a href="/src/products/product-details.html" class="quick-view" data-id="${n.id}">Quick View</a>
                </div>
                <div class="product-info">
                    <h3>${n.title}</h3>
                    <div class="product-price">${T(n.price)}</div>
                    <div class="product-rating">
                        ${"★".repeat(Math.round(n.rating.rate))}${"☆".repeat(5-Math.round(n.rating.rate))} 
                        <span class="review-count">(${n.rating.count})</span>
                    </div>
                    <button class="btn btn-primary add-to-cart" data-id="${n.id}">
                        Add to Cart
                    </button>
                </div>
            </div>
        `).join("");const i=Math.ceil(o.length/p);x.textContent=`Page ${s} of ${i}`,f.disabled=s===1,h.disabled=s===i||i===0,document.querySelectorAll(".add-to-cart").forEach(n=>{n.addEventListener("click",q)}),document.querySelectorAll(".quick-view").forEach(n=>{n.addEventListener("click",$)})}function u(){const t=v.value.toLowerCase(),a=b.value,e=I.value,i=E.value,n=k.value;switch(o=d.filter(r=>{const c=r.title.toLowerCase().includes(t)||r.description.toLowerCase().includes(t),g=!a||r.category===a;let y=!0;if(e){const[L,B]=e.split("-").map(Number);B?y=r.price>=L&&r.price<=B:y=r.price>=L}const F=!i||r.ageGroup===i;return c&&g&&y&&F}),n){case"price-low":o.sort((r,c)=>r.price-c.price);break;case"price-high":o.sort((r,c)=>c.price-r.price);break;case"rating":o.sort((r,c)=>c.rating.rate-r.rating.rate);break;case"newest":o.sort((r,c)=>c.id-r.id);break;default:o.sort((r,c)=>c.rating.rate*c.rating.count-r.rating.rate*r.rating.count);break}s=1,l()}function $(t){const a=t.target.dataset.id;window.location.href=`product-detail.html?id=${a}`}function q(t){const a=parseInt(t.target.dataset.id),e=d.find(g=>g.id===a);if(!e)return;let i=JSON.parse(localStorage.getItem("cart"))||[];const n=i.find(g=>g.id===a);n?n.quantity+=1:i.push({id:e.id,title:e.title,price:e.price,image:e.image,quantity:1}),localStorage.setItem("cart",JSON.stringify(i)),P();const r=t.target,c=r.textContent;r.textContent="Added!",r.classList.add("added"),setTimeout(()=>{r.textContent=c,r.classList.remove("added")},2e3)}f.addEventListener("click",()=>{s>1&&(s--,l())}),h.addEventListener("click",()=>{const t=Math.ceil(o.length/p);s<t&&(s++,l())}),v.addEventListener("keyup",t=>{t.key==="Enter"&&u()}),A.addEventListener("click",u),b.addEventListener("change",u),I.addEventListener("change",u),E.addEventListener("change",u),k.addEventListener("change",u);async function M(){const t=localStorage.getItem("cachedProducts");t&&(d=JSON.parse(t),o=[...d],l());const a=await S();a.length>0?(d=a,o=[...a],localStorage.setItem("cachedProducts",JSON.stringify(a))):(d=w(),o=[...d],m("⚠️ Using demo data - API may be unavailable")),l(),P()}M()});
